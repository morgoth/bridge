YUI.add("gallery-io-poller",function(B){var C,I="poller",D="interval",H="uri",J="ioConfig",K="polling",E="If-None-Match",G="If-Modified-Since",F="io:modified",A=B.Lang.isString,M=B.Lang.isNumber,L=B.Lang.isObject;C=function(N){C.superclass.constructor.apply(this,arguments);};B.mix(C,{NAME:I,ATTRS:{interval:{validator:M},uri:{validator:A,writeOnce:true},ioConfig:{validator:L,writeOnce:true},polling:{value:false,readOnly:true}}});B.extend(C,B.Base,{_timer:null,_txTime:null,_activeTx:null,_modifiedDate:null,_etag:null,initializer:function(N){this._timer=null;this._txTime=null;this._activeTx=null;this._modifiedDate=null;this._etag=null;},destructor:function(){this.stop();this._modifiedDate=null;this._etag=null;},start:function(){if(!this.get(K)){this._sendRequest();this._set(K,true);}},stop:function(){if(this._activeTx){this._activeTx.abort();this._activeTx=null;}if(this._timer){this._timer.cancel();this._timer=null;}this._txTime=null;this._set(K,false);},_sendRequest:function(){var N=this.get(J),P={},O;if(this._etag){P[E]=this._etag;}if(this._modifiedDate){P[G]=this._modifiedDate;}O=B.merge(N,{headers:B.merge(N.headers,P),context:this,on:B.merge(N.on,{start:this._defStartHandler,complete:this._defCompleteHandler,success:this._defSuccessHandler,modified:this._defModifiedHandler})});this._activeTx=B.io(this.get(H),O);},_defStartHandler:function(P,O){var N=this.get(J);this._txTime=new Date().getTime();if(N&&N.on&&N.on.start){N.on.start.apply(N.context||B,arguments);}},_defCompleteHandler:function(R,Q,O){var N=this.get(J),P=this._txTime?(new Date()).getTime()-this._txTime:0;this._timer=B.later(Math.max(this.get(D)-P,0),this,this._sendRequest);if(N&&N.on&&N.on.complete){N.on.complete.apply(N.context||B,arguments);}},_defSuccessHandler:function(Q,P,O){var N=this.get(J);if(N&&N.on&&N.on.success){N.on.success.apply(N.context||B,arguments);}this._defModifiedHandler.apply(this,arguments);},_defModifiedHandler:function(Q,P,O){var N=this.get(J);this._etag=P.getResponseHeader("Etag");this._modifiedDate=P.getResponseHeader("Last-Modified");B.fire(F,Q,P);if(N&&N.on&&N.on.modified){N.on.modified.apply(N.context||B,arguments);}}});B.mix(B.io,{poll:function(N,P,O){return new C({interval:N,uri:P,ioConfig:O});}},true);},"gallery-2009.11.19-20",{requires:["io-base","base-base"]});